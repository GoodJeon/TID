# 5월 3일 (화)

## 오늘 한 일

* 융합 프로젝트

  * 00:02

    * `from collections import Counter`를 사용해서 Like 수를 많이 받은 순으로 처리해보자.
    * ![image](https://user-images.githubusercontent.com/75322297/166257092-e1710eae-caf2-469d-89c1-19c8e50b8c5b.png)

  * 00:38

    * `.selected_related()`를 사용해 join해준다.

    * 그리고 빈 리스트를 변수 하나(`like_rank`)에 저장해준다.

    * 받은 객체에서 반복문을 통해 작성자의 이름을 뽑아낸 후 리스트에 append

    * 그리고 `Counter()`를 사용해 고유값과 그 개수를 추출하고

    * `.keys()`를 list화 해서 rank_names에 저장, `values()`를 list화 해서 rank_like_nums에 저장 

    * `.filter()` 사용 시, `__in=[]`를 사용하면 조건에 맞는 여러 쿼리셋을 가져올 수 있다.

      * 참고 : [https://devvvyang.tistory.com/37](https://devvvyang.tistory.com/37)

    * ```python
      def ranking(request):
          users = User.objects.all()
          reviews = Review.objects.all()
          comments = Comment.objects.all()
          
          # 리뷰 작성 수를 기준으로 내림차순으로 정렬(작성자, 작성 리뷰 수)
          # review_count = Review.objects.values('author').order_by('author').annotate(count=Count('author'))
          
          
          # 좋아요 수 조인 도전
          
          
          like_join = Like.objects.select_related('review_id')
          like_rank = []
          for obj in like_join:
              like_rank.append(obj.review_id.author.username)
          rank = Counter(like_rank)
          rank_names = list(rank.keys())
          rank_like_nums = list(rank.values()) 
          
          rank_objs = User.objects.filter(username__in=rank_names)
          context = {
              'users': users,
              'reviews': reviews,
              'comments': comments,
              # 'review_count': review_count,
              'rank_objs':rank_objs,
              'rank_like_nums':rank_like_nums,
          }
          return render(request, 'member/ranking.html', context)
      ```

  * 00:54

    * Counter 함수 값의 내림차순 자동 정렬 : `.most_common()`

  * 00:55

    * 좋아요 수는 알맞게 나오지만, 쿼리셋이 `username`으로 자동 정렬되서 나온다. 이러면안되는데!

  * 01:07

    * 일단 자고 일어나서 템플릿 언어좀 공부해야겠다.

  * 01:29

    * multi for loop : [https://velog.io/@juliajh/Django-template%EC%97%90%EC%84%9C-index-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0multi-for-loop](https://velog.io/@juliajh/Django-template%EC%97%90%EC%84%9C-index-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0multi-for-loop)
      * 리스트를 views.py에서 zip한다음, 템플릿에서 사용

  * 08:15

    * ```python
      {% extends 'base.html' %}
      
      {% block content %}
      <div class="meok-rank">
          <h1>먹보 랭킹🏆</h1>
          {% for name, num in rank_list %}
              <div class="rank_box" id="rank-{{ forloop.counter }}">
                  
              </div>
              {{ forloop.counter }}{{ '위' }}
              {{ name }} {{ '님' }}  {{ '좋아요' }} {{ num }} {{ '개' }}
          {% endfor %}
          
          {{ rank_names|length }}
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          {{ rank_objs }}
      </div>
      
      {% endblock %}
      ```

    * ![image](https://user-images.githubusercontent.com/75322297/166341063-49ef5857-ae2d-4386-9b86-ff42c6652a25.png)

    * `forloop.counter`의 유용한 점은 1부터 시작할 수도 있고 0부터(conter0) 시작할 수도 있다는 것이다.