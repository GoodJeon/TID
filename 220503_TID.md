# 5ì›” 3ì¼ (í™”)

## ì˜¤ëŠ˜ í•œ ì¼

* ìœµí•© í”„ë¡œì íŠ¸

  * 00:02	

    * `from collections import Counter`ë¥¼ ì‚¬ìš©í•´ì„œ Like ìˆ˜ë¥¼ ë§ì´ ë°›ì€ ìˆœìœ¼ë¡œ ì²˜ë¦¬í•´ë³´ì.
    * ![image](https://user-images.githubusercontent.com/75322297/166257092-e1710eae-caf2-469d-89c1-19c8e50b8c5b.png)

  * 00:38

    * `.selected_related()`ë¥¼ ì‚¬ìš©í•´ joiní•´ì¤€ë‹¤.

    * ê·¸ë¦¬ê³  ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³€ìˆ˜ í•˜ë‚˜(`like_rank`)ì— ì €ì¥í•´ì¤€ë‹¤.

    * ë°›ì€ ê°ì²´ì—ì„œ ë°˜ë³µë¬¸ì„ í†µí•´ ì‘ì„±ìì˜ ì´ë¦„ì„ ë½‘ì•„ë‚¸ í›„ ë¦¬ìŠ¤íŠ¸ì— append

    * ê·¸ë¦¬ê³  `Counter()`ë¥¼ ì‚¬ìš©í•´ ê³ ìœ ê°’ê³¼ ê·¸ ê°œìˆ˜ë¥¼ ì¶”ì¶œí•˜ê³ 

    * `.keys()`ë¥¼ listí™” í•´ì„œ rank_namesì— ì €ì¥, `values()`ë¥¼ listí™” í•´ì„œ rank_like_numsì— ì €ì¥ 

    * `.filter()` ì‚¬ìš© ì‹œ, `__in=[]`ë¥¼ ì‚¬ìš©í•˜ë©´ ì¡°ê±´ì— ë§ëŠ” ì—¬ëŸ¬ ì¿¼ë¦¬ì…‹ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

      * ì°¸ê³  : [https://devvvyang.tistory.com/37](https://devvvyang.tistory.com/37)

    * ```python
      def ranking(request):
          users = User.objects.all()
          reviews = Review.objects.all()
          comments = Comment.objects.all()
          
          # ë¦¬ë·° ì‘ì„± ìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬(ì‘ì„±ì, ì‘ì„± ë¦¬ë·° ìˆ˜)
          # review_count = Review.objects.values('author').order_by('author').annotate(count=Count('author'))
          
          
          # ì¢‹ì•„ìš” ìˆ˜ ì¡°ì¸ ë„ì „
          
          
          like_join = Like.objects.select_related('review_id')
          like_rank = []
          for obj in like_join:
              like_rank.append(obj.review_id.author.username)
          rank = Counter(like_rank)
          rank_names = list(rank.keys())
          rank_like_nums = list(rank.values()) 
          
          rank_objs = User.objects.filter(username__in=rank_names)
          context = {
              'users': users,
              'reviews': reviews,
              'comments': comments,
              # 'review_count': review_count,
              'rank_objs':rank_objs,
              'rank_like_nums':rank_like_nums,
          }
          return render(request, 'member/ranking.html', context)
      ```

  * 00:54

    * Counter í•¨ìˆ˜ ê°’ì˜ ë‚´ë¦¼ì°¨ìˆœ ìë™ ì •ë ¬ : `.most_common()`

  * 00:55

    * ì¢‹ì•„ìš” ìˆ˜ëŠ” ì•Œë§ê²Œ ë‚˜ì˜¤ì§€ë§Œ, ì¿¼ë¦¬ì…‹ì´ `username`ìœ¼ë¡œ ìë™ ì •ë ¬ë˜ì„œ ë‚˜ì˜¨ë‹¤. ì´ëŸ¬ë©´ì•ˆë˜ëŠ”ë°!

  * 01:07

    * ì¼ë‹¨ ìê³  ì¼ì–´ë‚˜ì„œ í…œí”Œë¦¿ ì–¸ì–´ì¢€ ê³µë¶€í•´ì•¼ê² ë‹¤.

  * 01:29

    * multi for loop : [https://velog.io/@juliajh/Django-template%EC%97%90%EC%84%9C-index-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0multi-for-loop](https://velog.io/@juliajh/Django-template%EC%97%90%EC%84%9C-index-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0multi-for-loop)
      * ë¦¬ìŠ¤íŠ¸ë¥¼ views.pyì—ì„œ zipí•œë‹¤ìŒ, í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©

  * 08:15

    * ```python
      {% extends 'base.html' %}
      
      {% block content %}
      <div class="meok-rank">
          <h1>ë¨¹ë³´ ë­í‚¹ğŸ†</h1>
          {% for name, num in rank_list %}
              <div class="rank_box" id="rank-{{ forloop.counter }}">
                  
              </div>
              {{ forloop.counter }}{{ 'ìœ„' }}
              {{ name }} {{ 'ë‹˜' }}  {{ 'ì¢‹ì•„ìš”' }} {{ num }} {{ 'ê°œ' }}
          {% endfor %}
          
          {{ rank_names|length }}
          <br>
          <br>
          <br>
          <br>
          <br>
          <br>
          {{ rank_objs }}
      </div>
      
      {% endblock %}
      ```

    * ![image](https://user-images.githubusercontent.com/75322297/166341063-49ef5857-ae2d-4386-9b86-ff42c6652a25.png)

    * `forloop.counter`ì˜ ìœ ìš©í•œ ì ì€ 1ë¶€í„° ì‹œì‘í•  ìˆ˜ë„ ìˆê³  0ë¶€í„°(conter0) ì‹œì‘í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

  * 09:59

    * íšŒì›ê°€ì… ì‹œì— í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë¡œë“œ í•  ë•Œ DBì— ì €ì¥ì´ ë˜ì§€ ì•Šì•˜ëŠ”ë°, í•´ê²°í–ˆë‹¤.

      ![image](https://user-images.githubusercontent.com/75322297/166392962-e96963d1-ae05-44e3-b9b7-71ecbf62c294.png)

    * ì´ë¯¸ì§€ì™€ ê°™ì€ íŒŒì¼ì„ í¬í•¨í•´ì„œ ë°›ëŠ” formì€ `enctype=multipart/form-data`ë¥¼ ê¼­ ì ì–´ì¤˜ì•¼ íŒŒì¼ ì…ì¶œë ¥ì´ ê°€ëŠ¥í•˜ë‹¤.

    * `include`ë¥¼ ì‚¬ìš©í•´ì„œ `enctype='file'`ë¡œ ì§€ì •í•´ì„œ ë³´ë‚´ë©´

    * formì—ì„œëŠ” í…œí”Œë¦¿ ì–¸ì–´ë¡œ ì¡°ê±´ì„ ë°›ì•„ì„œ enctypeì„ ë³€í™˜í•´ì¤€ë‹¤.

      ```html
      <form action="" method="post"{% if enctype == 'file' %} enctype="multipart/form-data"{% endif %}>
          {% csrf_token %}
          {% for field in form %}
              <div class="form-group{% if field.erros %} has-error{% endif %}">
                  {{ field.label_tag }}
                  {{ field }}
                  {% if field.errors %}
                      {% for error in field.errors %}
                      <span class="help-block">{{ error }}</span>
                      {% endfor %}
                  {% endif %}
              </div>
          {% endfor %}
      
          {% if form.non_field_errors %}
              {% for error in login_form.non_field_errors %}
              <p class="text-danger"><b>{{ error }}</b></p>
              {% endfor %}
          {% endif %}
          <button class="btn btn-primary btn-block">{{ submit_title }}</button>
      </form>
      ```

  * 11:35

    * í”„ë¡œí•„ ì‚¬ì§„ì´ ì˜ ë‚˜ì˜¤ê²Œ ë§Œë“¤ì—ˆê³ , ì‚¬ì§„ì´ ë¹„ì–´ìˆë‹¤ë©´ ê¸°ë³¸ ì´ë¯¸ì§€ê°€ ë‚˜ì˜¤ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

      ![image](https://user-images.githubusercontent.com/75322297/166396732-a09ede57-dc27-4ef8-8a18-b79f01d52835.png)

    * ```html
      <div class="profile_img_box">
      	{% for obj in rank_objs %}
          {% if obj.id == id %}
          	<img class="profile_img" {% if obj.img_profile != '' %}src="/media/{{ obj.img_profile }}" {% else %} src="{% static 'resources/images/user.png' %}" {% endif %} alt="" style="width:100px;height:100px;">
          {% endif %}
          {% endfor %}
      </div>
      ```

  * 13:20

    * ìš°ë¦¬ê°€ ì •í•´ë†“ì€ ê³„ê¸‰(ë ˆë²¨)

      * **ë¨¹ì•Œëª»/ë¨¹ë¦°ì´/ë¨¹ì†Œë…„/ë¨¹ì²­ë…„/ë¨¹ì˜ì•Œ**
      * ì¢‹ì•„ìš” ìˆ˜ê°€ 1ê°œ ì´ìƒì´ë©´ ë¨¹ì•Œëª»
      * 10ê°œ ì´ìƒì´ë©´ ë¨¹ë¦°ì´
      * 20ê°œ ì´ìƒì´ë©´ ë¨¹ì†Œë…„
      * 50ê°œ ì´ìƒì´ë©´ ë¨¹ì²­ë…„
      * 100ê°œ ì´ìƒì´ë©´ ë¨¹ì˜ì•Œ

    * `ranking.html`

      ```html
      {% if num >= 100 %}
      <div class="info_grade">ë¨¹ì˜ì•Œ</div>
      {% elif num >= 50 %}
      <div class="info_grade">ë¨¹ì²­ë…„</div>
      {% elif num >= 20 %}
      <div class="info_grade">ë¨¹ì†Œë…„</div>
      {% elif num >= 10 %}
      <div class="info_grade">ë¨¹ë¦°ì´</div>
      {% elif num >= 1 %}
      <div class="info_grade">ë¨¹ì•Œëª»</div>
      {% endif %}
      ```

  * 14:06

    * objectì™€ stringì„ ë¹„êµí•˜ë©´ ì œëŒ€ë¡œ ë¹„êµê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ objectì— stringformatì„ í•´ì¤˜ì•¼í•¨.

    * ```html
      {% if review.author|stringformat:"s" == name %}
      ```

    * ìš”ë¡ ì‹ìœ¼ë¡œ 

    * ì°¸ê³  : [http://namineya-textcube.blogspot.com/2010/04/django-html-%ED%8E%98%EC%9D%B4%EC%A7%80%EC%97%90%EC%84%9C-int-str%ED%98%95%EC%9C%BC%EB%A1%9C-%EB%B3%80%ED%99%98-%EB%B0%A9%EB%B2%95.html](http://namineya-textcube.blogspot.com/2010/04/django-html-%ED%8E%98%EC%9D%B4%EC%A7%80%EC%97%90%EC%84%9C-int-str%ED%98%95%EC%9C%BC%EB%A1%9C-%EB%B3%80%ED%99%98-%EB%B0%A9%EB%B2%95.html)

  * 14:31

    * ì¬ì •ë‹˜ì´ DBì— ì˜¬ë¦´ ìŒì‹ì  ë°ì´í„° ì˜ˆì •

      ```
      ìŒì‹ì  API ( MySQL rest [ ì˜ˆì • ] )
      id	s_name	s_add	s_road	s_kind	lat	lot	s_status
      
      ìŒì‹ì  ì„¸ë¶€ ì •ë³´ ( MySQL rest_detail [ ì˜ˆì • ] )
      id	s_name	s_tel	s_etc	s_hour	s_photo	s_menu	s_price
      ```

  * 14:44

    * í•´ë‹¹ ìœ ì €ê°€ ì‘ì„±í•œ ë¦¬ë·°ë“¤ì´ ì˜ ë‚˜ì˜¤ê²Œ ë§Œë“¦

      ![image](https://user-images.githubusercontent.com/75322297/166409254-06faefaa-e1bf-457b-a840-5eac0856e2c5.png)

  * 14:46

    * í•´ì•¼í•  ê²ƒ
      * ë§ˆì´í˜ì´ì§€
      * ê²€ìƒ‰ì°½ ë§Œë“¤ê¸°->ì—˜ë¼ìŠ¤í‹±ì´ë‘
      * ê¸€ ì‚­ì œ, ìˆ˜ì •
      * íšŒì› ì •ë³´ ë³€ê²½, íƒˆí‡´
      * ë¦¬ë·°ì— ì‘ì„±ì ë‹‰ë„¤ì„ê³¼ ì‚¬ì§„ëœ¨ê²Œí•˜ê¸°

  * 15:17

    * ë¦¬ë·°ì— ì‘ì„±ì ë‹‰ë„¤ì„ê³¼ ì‚¬ì§„ëœ¨ê²Œ ë§Œë“œëŠ”ê±° êµ¬í˜„ ì¤‘

  * 15:27

    * ë¦¬ë·°ì— ì‘ì„±ì ë‹‰ë„¤ì„ê³¼ ì‚¬ì§„ëœ¨ê²Œ ë§Œë“œëŠ”ê±° êµ¬í˜„ ì„±ê³µ

    * ```python
      <div class="panel-head">
          <img class="review_author_img" {% if review.author.img_profile != '' %}src="/media/{{ review.author.img_profile }}" {% else %} src="{% static 'resources/images/user.png' %}" {% endif %} alt="" style="width:30px;height:30px;">
          <p class="review_author_nickname">{{ review.author.nickname }}</p>
      </div>
      ```

    * ![image](https://user-images.githubusercontent.com/75322297/166412348-112077bb-df67-478f-ad50-b2a41b015c2a.png)

  * 15:42

    * ê¸°ì¡´ usernameë“¤ì„ ë‹¤ ë‹‰ë„¤ì„ìœ¼ë¡œ í‘œì‹œë˜ë„ë¡ ë°”ê¿¨ë‹¤.

  * 15:46

    * ê²Œì‹œë¬¼(review) ì— ë¬¸ìë‚´ìš©ë„ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì•¼í•œë‹¤.

    * ëª¨ë¸ ì„¤ì •, ë° ì—¬ëŸ¬ê°€ì§€ ê³ ë ¤í•´ì•¼ í•¨

    * ê¸€ ë‚´ìš©ì€ 400ìë¡œ ì§“ê¸°ë¡œ í•¨

      ![image](https://user-images.githubusercontent.com/75322297/166414298-7eb960bb-b225-4d5e-b79c-31810ea6302f.png)

  * 16:13

    * review app ì˜ `models.py`ì—ì„œ review ëª¨ë¸ì— content ì¶”ê°€

      ```python
      class Review(models.Model):
          author = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
          photo = models.ImageField(upload_to='review')
          content = models.TextField(max_length=400)
      
          def __str__(self):
              return f'Review (PK: {self.pk}, Author: {self.author.username})'
      ```

    * `forms.py`ì˜ fieldsì—ë„ ì¶”ê°€

      ```python
      class ReviewForm(forms.ModelForm):
          class Meta:
              model = Review
              fields = (
                  'photo',
                  'content',
              )
      ```

  * 16:19

    * migrate ì¤‘ ì—ëŸ¬

      * `django.db.utils.OperationalError: (1060, "Duplicate column name 'review_id_id'")`

    * migration íŒŒì¼ì—ì„œ ìˆ˜ì •

      ![image](https://user-images.githubusercontent.com/75322297/166419750-3374d89f-bb5d-44ae-9f29-d9cf01e69688.png)

  * 16:48

    * ë‹¤ë¥¸ ì—ëŸ¬
      * `django.core.exceptions.FieldDoesNotExist: User has no field named 'like_reviews'`
      * remove, alterë¥¼ ì—†ì• ê³  addë¡œ ë°”ê¿”ì¤Œ
    * ê·¸ëŸ¬ê³  ë‚˜ë‹ˆ í…Œì´ë¸”ì´ ì¡´ì¬í•œë‹¤ê³  ë‚œë¦¬ì‹œë‹¤ ^^...
      * `django.db.utils.OperationalError: (1050, "Table 'likelike' already exists")`
    * ì„¤ë§ˆ ë˜ ì§€ì›Œì•¼ í•˜ë‚˜

  * 17:03

    * `python manage.py migrate --fake member` í›„ ë‹¤ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë§Œë“¤ê³  migrateí•˜ë‹ˆ ì˜ ì¼œì¡Œë‹¤.
    * í•˜ì§€ë§Œ, ê²°êµ­ `likelike`í…Œì´ë¸”ì´ ì‚¬ë¼ì¡Œë„¤ ^^í•˜í•˜

  * 17:05

    * ì¶”ê°€ë¡œ review_review í…Œì´ë¸”ì— ì»¬ëŸ¼ì´ ì—†ì–´ì„œ ì˜¤ë¥˜ê°€ ë‚œ ê²ƒ ê°™ë‹¤.

      ![image](https://user-images.githubusercontent.com/75322297/166421588-8ce9b19b-fedd-471b-a11a-dc699168d293.png)

      â€‹	

    * ![image](https://user-images.githubusercontent.com/75322297/166421779-7633af05-ed4c-4c11-aa5a-f8edb7a30b6f.png)

    *  workbenchì—ì„œ ì»¬ëŸ¼ ì¶”ê°€

  * 17:16

    * ê·¸ëƒ¥ DB ì „ë¶€ ë‚ ë ¤ì•¼ê² ë‹¤ ê·¸ê²Œ ë§˜ì´ í¸í•  ê²ƒ ê°™ë‹¤.
    
  * 17:21
  
    * DB(meok4) ì´ˆê¸°í™”
  
      ```mysql
      SET @tables = NULL;
      SELECT GROUP_CONCAT(table_schema, '.', table_name) INTO @tables
        FROM information_schema.tables
        WHERE table_schema = 'DBì´ë¦„ ì…ë ¥'; -- specify DB name here.
      
      SET @tables = CONCAT('DROP TABLE ', @tables);
      PREPARE stmt FROM @tables;
      EXECUTE stmt;
      DEALLOCATE PREPARE stmt;
      ```
  
  * 17:36
  
    * ì¢‹ì•„ìš”ì™€ ëŒ“ê¸€ ì‚¬ì´ì— ë¦¬ë·° ì‘ì„±ë‚´ìš©ì´ ë“¤ì–´ê°„ë‹¤.
  
  * 17:45
  
    * êµ¬í˜„ ì™„ë£Œ
  
      ![image](https://user-images.githubusercontent.com/75322297/166426283-eac8dbff-69b7-45ad-a71b-0c47c430b581.png)
  
    * `review.html`ì„ ì¡°ê¸ˆ ìˆ˜ì •í–ˆë‹¤.
  
      * ```html
        <p><b>{{ review.author.nickname }}</b>  {{ review.content }}</p>
        ```





