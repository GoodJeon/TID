# 5월 6일 (금)

## 오늘 한 일

* 융합 프로젝트

  * 00:02

    * 마이페이지 계속 구현 중

  * 00:13

    * `request.user`로 현재 로그인 중인 유저의 id를 알 수 있음

  * 00:29

    * 랭크페이지와 다르게 요청 유저의 id(username)을 알 수 있어서 보내야하는 값들을 너무너무 수월하게 정해줄 수 있었다.

      ```python
      # 마이 페이지
      def mypage(request):
          # 현재 접속한 유저 정보(인덱싱으로 쿼리셋 풀어서 객체 하나만 보내기)
          user = User.objects.filter(username=request.user)[0]
          # 현재 접속한 유저가 작성한 리뷰들
          reviews = Review.objects.filter(author=request.user)
          # 현재 접속한 유저가 작성한 리뷰 수
          review_counts = len(reviews)
          
          # 현재 접속한 유저가 리뷰를 작성해서 받은 좋아요 수
          likes = Like.objects.select_related('review_id')
          like_counts = 0
          for like in likes:
              if like.review_id.author == request.user:
                  like_counts += 1
          
          context = {
              'user':user,
              'reviews':reviews,
              'review_counts':review_counts,
              'like_counts':like_counts,
          }
          return render(request, 'member/mypage.html', context)
      ```

  * 01:00

    * 마이페이지 ver1 완료

      ```html
      {% extends 'base.html' %}
      {% load static %}
      {% block content %}
      <div id="body_middle">
          <div class="my-profile">
              <div class="my_img_box">
                  <img class="my_img" {% if user.img_profile != '' %} src="/media/{{ user.img_profile }}" {% else %} src="{% static 'resources/images/user.png' %}" {% endif %} alt="" style="width:100px;height:100px;">
              </div>
              <div class="my_info">
                  <div class="my_nickname">{{ user.nickname }}</div>
      
                  {% if like_counts >= 100 %}
                  <div class="my_grade">먹잘알</div>
                  {% elif like_counts >= 50 %}
                  <div class="my_grade">먹청년</div>
                  {% elif like_counts >= 20 %}
                  <div class="my_grade">먹소년</div>
                  {% elif like_counts >= 10 %}
                  <div class="my_grade">먹린이</div>
                  {% elif like_counts >= 1 %}
                  <div class="my_grade">먹알못</div>
                  {% endif %}
      
                  <div class="my_wreview">리뷰 {{ review_counts }}개</div>
                  <div class="my_likes">좋아요 {{ like_counts }}개</div>
      
              </div>
          </div>
          <div class="my-reviews">
              {% for review in reviews %}
              <div class="my_review" id="my_review_{{forloop.counter}}">
                  <a href="{% url 'review:review_detail' review_pk=review.pk %}">
                      <img src="{{ review.photo.url }}" alt="" class="rank-review-image" style="width: 100%;">
                  </a>
              </div>
              {% endfor %}
          </div>
      
      
          <a href="{% url 'member:logout' %}">로그아웃</a>
      </div>
      {% endblock %}
      ```

    * 랭킹페이지의 쉬운 버전이라고 생각하면 된다. 하지만, 간단한 자기소개,  프로필 수정하는 부분을 만들어줘야 한다.

  * 01:08

    * User 모델에서 자기소개 내용인 `introduce` 컬럼을 생성

      * 비어있어도 되기때문에 null, blank 둘다 True

      ```python
      introduce = models.TextField(max_length=100,null=True, blank=True)
      ```

  * 01:12

    * `mypage.html`에 해당 내용 작성

      ```html
      <div class="my-introduce">
          {% if user.introduce != None %}
              {{ user.introduce }}
          {% endif %}
      </div>
      ```

    * 인스타에서도 보면 자기소개가 없으면 아무것도 보여주지 않는다. 또한, introduce가 비어있다면 `None`이라는 값이 표시되기 때문에, 저렇게 조건을 걸어줬다.

      ![image](https://user-images.githubusercontent.com/75322297/166967763-f3523875-c46b-45b5-8afa-1a6f5fece6e5.png)

  * 01:18

    * 이제 프로필을 수정할 수 있게 만들자.

  * 02:00

    * `UserChangeForm`을 사용할 것이다.

  * 02:40

    * 이거 안좋다. 이상한 것도 뜨고 유저가 하나 더 생겨버린다. 이상한 비밀번호 어쩌구도 뜨고 ...

  * 02:49

    * 새로 생기는 이유를 알아보니, views에서 내가 Commit=False인 form을 만들어서 그렇다. 바로 `save()`해주면 된다. 또한, `instance=request.user`로 요청한 user도 가져와야 한다.
    * 잘 장독하지만, 지금 문제점은 회원가입할 때 처럼 form이 비어도 되는데 비면 안된다고 하는 것이 문제다.
    * 그래도 우선 user 인스턴스를 가져와서 **원래 닉네임**을 적어도 중복되지 않는다고 나오니까, 나중에 수정하고 우선 넘어가도록 하겠다.

  * 02:58

    * 해야할 것
      * 비밀번호 수정 기능, 회원 탈퇴 기능
      * 리뷰 수정, 삭제 기능
      * 상점 모델 만들기
      * 상점 리스트 구현 후 엘라스틱 서치와 연계
      * 상점 상세정보 페이지 구현